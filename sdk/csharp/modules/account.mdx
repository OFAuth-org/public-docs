---
title: "Account & Webhooks"
description: "Manage your OFAuth account, connections, settings, and handle webhook events"
---

## Account Info

Retrieve organization details for the authenticated API key.

```csharp
using OFAuth;

var client = new OFAuthClient("your-api-key");

var account = await client.GetAsync<WhoamiResponse>("/v2/account/whoami");
Console.WriteLine($"Account: {account.Id}");
```

## Connection Management

### List Connections

List all connections for your organization, optionally filtering by status.

```csharp
// List all connections
var connections = await client.GetAsync<ConnectionsListResponse>(
    "/v2/account/connections"
);
foreach (var conn in connections.List)
{
    Console.WriteLine($"{conn.Id}: {conn.UserData.Username} ({conn.Status})");
}

// List with filters
var activeConnections = await client.GetAsync<ConnectionsListResponse>(
    "/v2/account/connections",
    query: new Dictionary<string, string?>
    {
        ["status"] = "active",
        ["limit"] = "10"
    }
);
```

### Delete Connection

Disconnect a connection and log out the user. This stops billing for the connection.

```csharp
await client.DeleteAsync<object>("/v2/account/connections/conn_xxx");
```

### Invalidate Connection

Mark a connection as expired and log out the user. The connection record is preserved, allowing the user to reconnect.

```csharp
await client.PostAsync<object>("/v2/account/connections/conn_xxx/invalidate");
```

## Connection Settings

Get and update settings for individual connections, including vault cache configuration.

```csharp
// Get connection settings
var settings = await client.GetAsync<ConnectionSettingsResponse>(
    "/v2/account/connections/conn_xxx/settings"
);

// Update connection settings
await client.PatchAsync<object>(
    "/v2/account/connections/conn_xxx/settings",
    body: new { vaultCache = new { enabled = true } }
);
```

## Organization Settings

Get and update organization-level settings, including default vault cache configuration.

```csharp
// Get org settings
var orgSettings = await client.GetAsync<AccountSettingsResponse>(
    "/v2/account/settings"
);

// Update org settings
await client.PatchAsync<AccountSettingsResponse>(
    "/v2/account/settings",
    body: new {
        vaultCache = new { enabled = true },
        applyToExistingConnections = true
    }
);
```

---

## Webhook Verification

OFAuth sends webhook events using the [Svix](https://www.svix.com/) protocol with HMAC-SHA256 signatures. The SDK includes built-in verification and routing.

<Info>
  Webhooks are configured in the [OFAuth Dashboard](https://app.ofauth.com/platform/developers/webhooks). From there you can set your endpoint URL, select event types, view delivery history, and rotate secrets.
</Info>

### Event Types

<CardGroup cols={2}>
  <Card title="Connection Events" icon="link">
    **connection.created** — New connection established

    **connection.updated** — Connection status or data changed

    **connection.expired** — Connection session expired
  </Card>
  <Card title="System Events" icon="gear">
    **rules.updated** — Dynamic rules configuration changed
  </Card>
</CardGroup>

### Event Payload Structure

All webhook events follow the Svix format with these fields:

```json
{
  "eventType": "connection.created",
  "live": true,
  "data": {
    "connection": {
      "id": "conn_xxx",
      "platformUserId": "12345",
      "status": "active",
      "userData": {
        "userId": "12345",
        "name": "Display Name",
        "username": "creator",
        "avatar": "https://..."
      },
      "permissions": ["earnings:read", "subscribers:read"]
    },
    "clientReferenceId": "your-ref-id"
  }
}
```

### Verifying Signatures

<Warning>
  Always verify webhook signatures before processing events. The signing secret starts with `whsec_` and is available in your dashboard.
</Warning>

```csharp
using OFAuth.Webhooks;

// ASP.NET Core example
var payload = await new StreamReader(Request.Body).ReadToEndAsync();
var headers = Request.Headers.ToDictionary(h => h.Key, h => h.Value.ToString());

try
{
    var webhookEvent = WebhookVerifier.VerifyPayload(
        payload, headers, "whsec_your_signing_secret"
    );
    Console.WriteLine($"Event: {webhookEvent.EventType}");
    return Ok();
}
catch (WebhookVerificationException ex)
{
    return Unauthorized(new { error = ex.Message, code = ex.Code });
}
```

### Webhook Router

The SDK provides a router that verifies signatures and dispatches events to typed handlers.

```csharp
using OFAuth.Webhooks;

var router = new WebhookRouter("whsec_your_signing_secret");

router.On("connection.created", evt =>
{
    var data = WebhookVerifier.ParseEventData<ConnectionCreatedEventData>(evt);
    Console.WriteLine($"New connection: {data.Connection.Id} ({data.Connection.UserData?.Username})");
});

router.On("connection.expired", evt =>
{
    var data = WebhookVerifier.ParseEventData<ConnectionExpiredEventData>(evt);
    Console.WriteLine($"Connection expired: {data.Connection.Id}");
});

// ASP.NET Core endpoint
app.MapPost("/webhooks", async (HttpContext context) =>
{
    var payload = await new StreamReader(context.Request.Body).ReadToEndAsync();
    var headers = context.Request.Headers.ToDictionary(h => h.Key, h => h.Value.ToString());
    await router.HandlePayloadAsync(payload, headers);
    return Results.Ok();
});
```

## Best Practices

<CardGroup cols={2}>
  <Card title="Webhook Security" icon="shield-check">
    - Always verify HMAC signatures before processing
    - Use HTTPS endpoints only
    - Rotate secrets periodically via the dashboard
    - Log events for debugging delivery issues
  </Card>
  <Card title="Reliability" icon="rotate">
    - Process events idempotently (you may receive duplicates)
    - Respond with `200` quickly, then process async
    - Monitor delivery history in the dashboard
    - Use the router's `onError` handler for graceful failures
  </Card>
</CardGroup>

<Note>
  For webhook delivery behavior and retry policies, see the [Webhooks reference](/reference/webhooks).
</Note>
